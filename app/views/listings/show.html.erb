<h1><%= @listing.title %></h1>
<p><%= link_to "Edit listing", edit_listing_path(@listing.id), method: :get if @listing.user.id == current_user.id %></p>
<p><%= link_to "Back to main listing", listings_path, method: :get %></p>
<%= image_tag @listing.cover.url %>


<h2>Room photos</h2>
<% @listing.images.each do |image| %>
<%= image_tag image.url %>
<% end %>

<h2>Make a reservation</h2>

<%= form_for @reservation do |f| %>

	<%= f.hidden_field :listing_id, value: @listing.id %>

	<%= f.label :From %>
	<%= f.text_field :start_date %>

	<%= f.label :To %>
	<%= f.text_field :end_date %>

	<%= submit_tag("Reserve") %>
<% end %>

<% if @listing.reservations.length > 0 %>
	<% range = (@listing.reservations.first.start_date..@listing.reservations.first.end_date).to_a %>
<% end %>

<script type='text/javascript'>
	$(document).ready(function(){


<% if @listing.reservations.length > 0 %>
		var reserved = <%= raw range.to_json %>;
<% end %>

		$('#reservation_start_date').datepicker({
			autoclose: true,
			todayHighlight: true,
			format: "dd/mm/yyyy"
		});
		$('#reservation_end_date').datepicker({
			autoclose: true,
			format: "dd/mm/yyyy"
		});
	})
</script>